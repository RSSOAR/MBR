<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento de Coleta</title>
    <link rel="stylesheet" href="./assets/estilos/modal.css">
  </head>
  <body>
      
      <div class="modal" >
        <div id="app" >
          <main>
            <div class="main-container" id="topo"> 
              <h1>AGENDAR COLETA</h1>
              <div class="back">
                <img src="assets/icons/icon01 - setaEsq.svg" alt="Voltar">
                <a href="./index.html">
                <span>Voltar</span></a>
              </div>

              <h2>Formulário de Agendamento</h2>
              <p>Preencha os dados abaixo para agendar sua coleta.</p>

              <form id="meuFormulario">
                <fieldset class="child-info">
                  <legend>Informações para agendamento</legend>

                  <div class="input-wrapper">
                    <label for="fullname">Nome completo</label>
                    <input id="fullname" type="text" name="fullname" placeholder="Digite seu nome completo">
                  </div>
                  <div class="input-wrapper">
                    <label for="company">Nome da empresa</label>
                    <input id="company" type="text" name="company" placeholder="Digite o nome da empresa">
                  </div>
                  <div class="input-wrapper">
                    <label for="email">Email</label>
                    <input id="email" type="email" name="email" placeholder="Digite seu melhor email">
                  </div>
                  <div class="input-wrapper">
                      <label for="phone">Telefone</label>
                      <input type="tel" name="phone" id="phone" placeholder="(xx) xxxxx-xxxx">
                  </div>
                
                  <div class="input-wrapper">
                    <label for="data">Data do agendamento</label>
                    <input type="date" id="data" lang="pt-br" name="data">
                  </div>
                  <fieldset class="enroll-options">
                    <legend>Opções de coleta</legend>
                    <div class="input-wrapper">
                    <label >Selecione o turno para coleta</label>

                    <div class="radio-wrapper">

                      <div class="radio-inner">
                        <div class="radio-image"></div>
                        <input type="radio" name="study-shif" value="morning" id="morning">
                        <img src="assets/icons/icon02.png" alt="icone de nuvem com sol">
                        <label for="morning">Manhã</label>
                      </div>

                      <div class="radio-inner">
                        <div class="radio-image"></div>
                        <input type="radio" name="study-shif" value="evening" id="evening">
                        <img src="assets/icons/icon01.png" alt="icone de sol">
                        <label for="evening">Tarde</label>
                      </div>

                    </div>

                    </div>
                  </fieldset>


                  
                  <!--</div>-->

                </fieldset>

                <fieldset class="address">
                  <legend>Endereço de retirada</legend>
                  <div class="input-wrapper">
                    <label for="cep">CEP</label>
                    <input type="text" id="CEP" name="CEP">
                  </div>

                  <div class="flex">
                    <div class="input-wrapper flex-2">
                      <label for="Street">Rua</label>
                      <input type="text" id="Street" name="Street">
                    </div>
                              
                    <div class="input-wrapper flex-1">
                      <label for="number">Número</label>
                      <input type="number" id="number" name="number">
                    </div>
                  </div>
                  <div class="input-wrapper flex-2">
                      <label for="complemento">Complemento</label>
                      <input type="text" id="complemento" name="complemento">
                    </div> 
                  <div class="flex">
                    <div class="input-wrapper flex-2">
                      <label for="city">Cidade</label>
                      <input type="text" id="city" name="city" placeholder= "Rio de Janeiro">
                    </div>
                              
                    <div class="input-wrapper flex-1">
                      <label for="state">Estado</label>
                      <select id="estado" name="estado" value="RJ">
                        <option value="AC">AC</option>
                        <option value="AL">AL</option>
                        <option value="AP">AP</option>
                        <option value="AM">AM</option>
                        <option value="BA">BA</option>
                        <option value="CE">CE</option>
                        <option value="DF">DF</option>
                        <option value="ES">ES</option>
                        <option value="GO">GO</option>
                        <option value="MA">MA</option>
                        <option value="MT">MT</option>
                        <option value="MS">MS</option>
                        <option value="MG">MG</option>
                        <option value="PA">PA</option>
                        <option value="PB">PB</option>
                        <option value="PR">PR</option>
                        <option value="PE">PE</option>
                        <option value="PI">PI</option>
                        <option value="RJ" selected>RJ</option>
                        <option value="RN">RN</option>
                        <option value="RS">RS</option>
                        <option value="RO">RO</option>
                        <option value="RR">RR</option>
                        <option value="SC">SC</option>
                        <option value="SP">SP</option>
                        <option value="SE">SE</option>
                        <option value="TO">TO</option>
                      </select>
                    </div>

                  </div>
                  <div class="textarea-wrapper">
                    <label for="medical-info">Digite sua dúvida</label>
                    <textarea name="medical-info" id="medical-info" placeholder="Digite sua dúvida aqui." cols="30" rows="5"></textarea>
                  </div>

                </fieldset>
                <div class="actions-wrapper">
                  <button class="btn-secondary" type="reset">Limpar Respostas</button>
                  <button class="btn-primary" type="submit">Fazer Agendamento</button>
                </div>

              </form>

            </div>
             <a href="#topo"  id="btn-topo">
                <img src="./assets/IMG/circle-uo.png" alt="Icone de voltar ao topo da página">
             </a href="#topo">
          </main>
        </div>
      </div>
      <div class="mascara-modal">
        
      </div>

    <script>
      // Máscaras
      document.getElementById("phone").addEventListener("input", function () {
        let valor = this.value.replace(/\D/g, "");
        if (valor.length > 11) valor = valor.slice(0, 11);
        if (valor.length > 6) {
          this.value = `(${valor.slice(0, 2)}) ${valor.slice(2, 7)}-${valor.slice(7)}`;
        } else if (valor.length > 2) {
          this.value = `(${valor.slice(0, 2)}) ${valor.slice(2)}`;
        } else {
          this.value = valor;
        }
      });

      document.getElementById("CEP").addEventListener("blur", function () {
        const cep = this.value.replace(/\D/g, "");
        if (cep.length !== 8) return;
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
          .then(res => res.json())
          .then(data => {
            if (!data.erro) {
              document.getElementById("Street").value = data.logradouro || '';
              document.getElementById("city").value = data.localidade || '';
              document.getElementById("estado").value = data.uf || 'RJ';
            } else {
              alert("CEP não encontrado.");
            }
          })
          .catch(() => alert("Erro ao buscar o endereço pelo CEP."));
      });

      document.getElementById("meuFormulario").addEventListener("submit", async function (event) {
      event.preventDefault();
      const form = event.target;
      const camposObrigatorios = ["fullname", "email", "phone", "data", "CEP", "Street", "number", "city"];
      let mensagemErro = "";
      camposObrigatorios.forEach(id => {
        const valor = form[id].value.trim();
        if (!valor) mensagemErro += `- Campo ${id} é obrigatório.\n`;
      });

      const email = form.email.value;
      const telefone = form.phone.value.replace(/\D/g, "");
      const turno = form["study-shif"].value;
      if (!/\S+@\S+\.\S+/.test(email)) mensagemErro += "- E-mail inválido.\n";
      if (telefone.length < 10) mensagemErro += "- Telefone inválido.\n";
      if (!turno) mensagemErro += "- Selecione o turno.\n";

      if (mensagemErro) return alert("Corrija os erros:\n" + mensagemErro);

      const nome = form.fullname.value;
      const empresa = form.company.value;
      const dataISO = form.data.value;
      const [ano, mes, dia] = dataISO.split("-");
      const data = `${dia}/${mes}/${ano.slice(2)}`;
      //const data = form.data.value;
      const rua = form.Street.value;
      const numero = form.number.value;
      const complemento = form.complemento.value;
      const cidade = form.city.value;
      const estado = form.estado.value;
      const cep = form.CEP.value;
      const duvida = form["medical-info"].value || "(Não informado)";
      const turnoTexto = turno === "morning" ? "Manhã" : "Tarde";
      
      const mensagem =
  `*Solicitação de Agendamento:*

  *Nome:* ${nome}
  *Empresa:* ${empresa}
  *E-mail:* ${email}
  *Telefone:* ${form.phone.value}
  *Data do agendamento:* ${data}
  *Turno:* ${turnoTexto}

  *Endereço de retirada:*
  Rua: ${rua}, Nº ${numero}, ${complemento}
  Cidade: ${cidade} - ${estado}
  CEP: ${cep}

  *Dúvida:* ${duvida}`;

      // WhatsApp
      const numeroWhatsApp = "5521995588692"; // Altere para seu número
      const link = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;
      window.open(link, "_blank");
      alert("Agendamento iniciado com sucesso! Você será redirecionado ao WhatsApp.");
    });
    
      // Configuração Botão Voltar ao Topo
      const btnTopo = document.getElementById("btn-topo");

      window.addEventListener("scroll", () => {
        const scrollTotal = document.documentElement.scrollHeight - window.innerHeight;
        const scrollAtual = window.scrollY;

        if (scrollAtual > scrollTotal * 0.8) {
          btnTopo.classList.add("show");
        } else {
          btnTopo.classList.remove("show");
        }
      });

      btnTopo.addEventListener("click", () => {
        window.scrollTo({
          top: 0,
          behavior: "smooth"
        });
      });

    </script>
  </body>
</html>
